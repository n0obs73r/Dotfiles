function parseNumber(n){return n==undefined&&(n=""),n=n.replace(/,/g,".").replace(/ /g,""),n==""&&(n=0),n=parseInt(n),isNaN(n)&&(n=500),n<=150&&(n=150),n}function sortByKey(n,t){return n.sort(function(n,i){var r=n[t],u=i[t];return r<u?-1:r>u?1:0})}function rebindEvents(){$('[data-Action="RemoveUserAgent"]').unbind("click");$('[data-Action="RemoveUserAgent"]').click(function(){var t=$(this),n;if(confirm("Remove this device?"))for(n=0;n<userAgents.length;n++)userAgents[n].UserAgents.forEach(function(i,r){i.Id==t.attr("data-Id")&&(userAgents[n].UserAgents.splice(r,1),saveStorageData(),loadUserAgents())})});$('[data-Action="EditUserAgent"], [data-Action="NewUserAgent"]').unbind("click");$('[data-Action="EditUserAgent"], [data-Action="NewUserAgent"]').click(function(){var t,n;if($("#UserAgentId").val(""),$("#UserAgentName").val(""),$("#UserAgentString").val(""),$("#DimWidth").val("480"),$("#DimHeight").val("640"),t=$(this),t.attr("data-Id")!="")for(n=0;n<userAgents.length;n++)userAgents[n].UserAgents.forEach(function(n){n.Id==t.attr("data-Id")&&($("#UserAgentId").val(n.Id),$("#UserAgentName").val(n.Name),$("#UserAgentString").val(n.UserAgent),$("#DimWidth").val(n.Width),$("#DimHeight").val(n.Height))});$("#userAgentModalWindow").modal().show()})}function findAndRemove(n,t,i){$.each(n,function(r,u){u[t]==i&&n.splice(r,1)})}function loadStorageData(){userAgents=chrome.extension.getBackgroundPage().userAgents;var n=localStorage.rwdStore;n!=undefined&&(userAgents=JSON.parse(n))}function saveStorageData(){for(var n=0;n<userAgents.length;n++)userAgents[n].UserAgents=sortByKey(userAgents[n].UserAgents,"Name");userAgents=sortByKey(userAgents,"Name");localStorage.rwdStore=JSON.stringify(userAgents);chrome.extension.getBackgroundPage().runAppStart()}function loadUserAgentGroups(){var n=$("#UserAgentGroup");n.empty();userAgents.forEach(function(t){t.UserAgent==undefined&&n.append('<option value="'+t.Id+'">'+t.Name+"<\/option>")})}function loadUserAgents(){el=$("#UserAgents tbody");el.empty();userAgents.forEach(function(n){n.Id==$("#UserAgentGroup").val()&&n.UserAgents.forEach(function(n){rowString="<tr>";rowString=rowString+"<td>"+n.Name+" ("+n.Height+"x"+n.Width+")<\/td>";rowString=rowString+'<td style="text-align:center;width:180px;">';rowString=rowString+'<button class="btn btn-mini btn-info" data-Action="EditUserAgent" data-Id="'+n.Id+'"><i class="icon-pencil icon-white"><\/i> Edit<\/button>&nbsp;';rowString=rowString+'<button class="btn btn-mini btn-danger" data-Action="RemoveUserAgent" data-Id="'+n.Id+'"><i class="icon-remove icon-white"><\/i> Remove<\/button>';rowString=rowString+"<\/td>";rowString=rowString+"<\/tr>";el.append(rowString)})});rebindEvents()}var userAgents=chrome.extension.getBackgroundPage().userAgents;$(function(){loadStorageData();loadUserAgentGroups();loadUserAgents();$("#UserAgentGroup").change(function(){loadUserAgents()});$('[data-Action="RemoveGroup"]').click(function(){confirm("Remove this group and its devices?")&&(userAgents.forEach(function(n,t){n.Id==$("#UserAgentGroup").val()&&(userAgents.splice(t,1),saveStorageData())}),$("#UserAgentGroup option[value="+$("#UserAgentGroup").val()+"]").remove(),loadUserAgents())});$('[data-Action="NewGroup"]').click(function(){$("#GroupName").val("");$("#groupModalWindow").modal().show()});$('[data-Action="SaveGroup"]').click(function(){var n=$("#GroupName").val(),t,i;n=n.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ");n!=""&&(t="Id_"+Math.floor(Math.random()*1e6+1),i={Id:t,Name:n,UserAgents:[]},userAgents.push(i),saveStorageData(),loadUserAgentGroups(),$("#UserAgentGroup").val(t),loadUserAgents(),$("#groupModalWindow").modal("hide"))});$('[data-Action="SaveUserAgent"]').click(function(){var i=$("#UserAgentName").val(),r=$("#UserAgentString").val(),u=$("#DimHeight").val(),f=$("#DimWidth").val(),e,o,n,t;if(i=i.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," "),r=r.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," "),u=parseNumber(u),f=parseNumber(f),i!=""&&r!=""){for(e="Id_"+Math.floor(Math.random()*1e6+1),o={Id:e,Name:i,UserAgent:r,Height:u,Width:f},n=0;n<userAgents.length;n++)if(userAgents[n].Id==$("#UserAgentGroup").val())if($("#UserAgentId").val()!="")for(t=0;t<userAgents[n].UserAgents.length;t++)$("#UserAgentId").val()==userAgents[n].UserAgents[t].Id&&(userAgents[n].UserAgents[t].Name=i,userAgents[n].UserAgents[t].UserAgent=r,userAgents[n].UserAgents[t].Height=u,userAgents[n].UserAgents[t].Width=f);else userAgents[n].UserAgents.push(o);saveStorageData();loadUserAgents();$("#userAgentModalWindow").modal("hide")}})});